<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
    <changeSet author="mmcduffie (generated)" id="1" objectQuotingStrategy="QUOTE_ALL_OBJECTS" >    
        <sqlFile path='./oracle/seed_data/i2b2.sql'/>
        <sqlFile path='./oracle/seed_data/qt_priv.sql'/>
        <sqlFile path='./oracle/seed_data/qt_query_states_type.sql'/>
        <sqlFile path='./oracle/seed_data/qt_query_status_type.sql'/>
        <sqlFile path='./oracle/seed_data/qt_result_type.sql'/>
        <sqlFile path='./oracle/seed_data/searchapp_data.sql'/>
        <sqlFile path='./oracle/seed_data/create_synonyms.sql'/>
    </changeSet>        
    <changeSet author="mmcduffie (generated)" id="1418322143334-73" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <createView schemaName="SEARCHAPP" fullDefinition="true" viewName="SEARCH_AUTH_USER_SEC_ACCESS_V">CREATE OR REPLACE FORCE VIEW SEARCH_AUTH_USER_SEC_ACCESS_V (SEARCH_AUTH_USER_SEC_ACCESS_ID, SEARCH_AUTH_USER_ID, SEARCH_SECURE_OBJECT_ID, SEARCH_SEC_ACCESS_LEVEL_ID) AS SELECT
 sasoa.AUTH_SEC_OBJ_ACCESS_ID AS SEARCH_AUTH_USER_SEC_ACCESS_ID,
 sasoa.AUTH_PRINCIPAL_ID AS SEARCH_AUTH_USER_ID,
 sasoa.SECURE_OBJECT_ID AS SEARCH_SECURE_OBJECT_ID,
 sasoa.SECURE_ACCESS_LEVEL_ID AS SEARCH_SEC_ACCESS_LEVEL_ID
FROM SEARCH_AUTH_USER sau,
SEARCH_AUTH_SEC_OBJECT_ACCESS sasoa
WHERE
sau.ID = sasoa.AUTH_PRINCIPAL_ID
UNION
 SELECT
 sasoa.AUTH_SEC_OBJ_ACCESS_ID AS SEARCH_AUTH_USER_SEC_ACCESS_ID,
 sagm.AUTH_USER_ID AS SEARCH_AUTH_USER_ID,
 sasoa.SECURE_OBJECT_ID AS SEARCH_SECURE_OBJECT_ID,
 sasoa.SECURE_ACCESS_LEVEL_ID AS SEARCH_SEC_ACCESS_LEVEL_ID
FROM SEARCH_AUTH_GROUP sag,
SEARCH_AUTH_GROUP_MEMBER sagm,
SEARCH_AUTH_SEC_OBJECT_ACCESS sasoa
WHERE
sag.ID = sagm.AUTH_GROUP_ID
AND
sag.ID = sasoa.AUTH_PRINCIPAL_ID
UNION
SELECT
 sasoa.AUTH_SEC_OBJ_ACCESS_ID AS SEARCH_AUTH_USER_SEC_ACCESS_ID,
 NULL AS SEARCH_AUTH_USER_ID,
 sasoa.SECURE_OBJECT_ID AS SEARCH_SECURE_OBJECT_ID,
 sasoa.SECURE_ACCESS_LEVEL_ID AS SEARCH_SEC_ACCESS_LEVEL_ID
FROM SEARCH_AUTH_GROUP sag,
SEARCH_AUTH_SEC_OBJECT_ACCESS sasoa
WHERE
sag.group_category = 'EVERYONE_GROUP'
AND
sag.ID = sasoa.AUTH_PRINCIPAL_ID
 </createView>
    </changeSet>
</databaseChangeLog>
